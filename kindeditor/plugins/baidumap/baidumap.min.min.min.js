KindEditor.plugin("baidumap",function(e){var f=this,b="baidumap",d=f.lang(b+".");var a=e.undef(f.mapWidth,558);var c=e.undef(f.mapHeight,360);f.clickToolbar(b,function(){var g=['<div style="padding:10px 20px;">','<div class="ke-header">','<div class="ke-left">',d.address+' <input id="kindeditor_plugin_map_address" name="address" class="ke-input-text" value="" style="width:200px;" /> ','<span class="ke-button-common ke-button-outer">','<input type="button" name="searchBtn" class="ke-button-common ke-button" value="'+d.search+'" />',"</span>","</div>",'<div class="ke-right">','<input type="checkbox" id="keInsertDynamicMap" name="insertDynamicMap" value="1" /> <label for="keInsertDynamicMap">'+d.insertDynamicMap+"</label>","</div>",'<div class="ke-clearfix"></div>',"</div>",'<div class="ke-map" style="width:'+a+"px;height:"+c+'px;"></div>',"</div>"].join("");var l=f.createDialog({name:b,width:a+42,title:f.lang(b),body:g,yesBtn:{name:f.lang("yes"),click:function(r){var v=j.map;var u=v.getCenter();var q=u.lng+","+u.lat;var t=v.getZoom();var s=[i[0].checked?f.pluginsPath+"baidumap/01index.html":"http://api.map.baidu.com/staticimage","?center="+encodeURIComponent(q),"&zoom="+encodeURIComponent(t),"&width="+a,"&height="+c,"&markers="+encodeURIComponent(q),"&markerStyles="+encodeURIComponent("l,A")].join("");if(i[0].checked){f.insertHtml('<iframe src="'+s+'" frameborder="0" style="width:'+(a+2)+"px;height:"+(c+2)+'px;"></iframe>')}else{f.exec("insertimage",s)}f.hideDialog().focus()}},beforeRemove:function(){k.remove();if(n){n.write("")}p.remove()}});var o=l.div,h=e('[name="address"]',o),k=e('[name="searchBtn"]',o),i=e('[name="insertDynamicMap"]',l.div),j,n;var p=e('<iframe class="ke-textarea" frameborder="0" src="'+f.pluginsPath+'baidumap/map.html" style="width:'+a+"px;height:"+c+'px;"></iframe>');function m(){j=p[0].contentWindow;n=e.iframeDoc(p)}p.bind("load",function(){p.unbind("load");if(e.IE){m()}else{setTimeout(m,0)}});e(".ke-map",o).replaceWith(p);k.click(function(){j.search(h.val())})})});