KindEditor.plugin("filemanager",function(o){var n=this,m="filemanager",p=o.undef(n.fileManagerJson,n.basePath+"php/file_manager_json.php"),k=n.pluginsPath+m+"/images/",l=n.lang(m+".");function i(c,b,a){return c+" ("+Math.ceil(b/1024)+"KB, "+a+")"}function j(b,a){if(a.is_dir){b.attr("title",a.filename)}else{b.attr("title",i(a.filename,a.filesize,a.datetime))}}n.plugin.filemanagerDialog=function(L){var c=o.undef(L.width,650),e=o.undef(L.height,510),E=o.undef(L.dirName,""),H=o.undef(L.viewType,"VIEW").toUpperCase(),f=L.clickFn;var G=['<div style="padding:10px 20px;">','<div class="ke-plugin-filemanager-header">','<div class="ke-left">','<img class="ke-inline-block" name="moveupImg" src="'+k+'go-up.gif" width="16" height="16" border="0" alt="" /> ','<a class="ke-inline-block" name="moveupLink" href="javascript:;">'+l.moveup+"</a>","</div>",'<div class="ke-right">',l.viewType+' <select class="ke-inline-block" name="viewType">','<option value="VIEW">'+l.viewImage+"</option>",'<option value="LIST">'+l.listImage+"</option>","</select> ",l.orderType+' <select class="ke-inline-block" name="orderType">','<option value="NAME">'+l.fileName+"</option>",'<option value="SIZE">'+l.fileSize+"</option>",'<option value="TYPE">'+l.fileType+"</option>","</select>","</div>",'<div class="ke-clearfix"></div>',"</div>",'<div class="ke-plugin-filemanager-body"></div>',"</div>"].join("");var b=n.createDialog({name:m,width:c,height:e,title:n.lang(m),body:G}),g=b.div,I=o(".ke-plugin-filemanager-body",g),J=o('[name="moveupImg"]',g),D=o('[name="moveupLink"]',g),d=o('[name="viewServer"]',g),F=o('[name="viewType"]',g),O=o('[name="orderType"]',g);function h(r,t,s){var q="path="+r+"&order="+t+"&dir="+E;b.showLoading(n.lang("ajaxLoading"));o.ajax(o.addParam(p,q+"&"+new Date().getTime()),function(u){b.hideLoading();s(u)})}var P=[];function M(t,v,s,r){var u=o.formatUrl(v.current_url+s.filename,"absolute"),q=encodeURIComponent(v.current_dir_path+s.filename+"/");if(s.is_dir){t.click(function(w){h(q,O.val(),r)})}else{if(s.is_photo){t.click(function(w){f.call(this,u,s.filename)})}else{t.click(function(w){f.call(this,u,s.filename)})}}P.push(t)}function K(s,q){o.each(P,function(){this.unbind()});D.unbind();F.unbind();O.unbind();if(s.current_dir_path){D.click(function(t){h(s.moveup_dir_path,O.val(),q)})}function r(){if(F.val()=="VIEW"){h(s.current_dir_path,O.val(),a)}else{h(s.current_dir_path,O.val(),N)}}F.change(r);O.change(r);I.html("")}function N(r){K(r,N);var t=document.createElement("table");t.className="ke-table";t.cellPadding=0;t.cellSpacing=0;t.border=0;I.append(t);var u=r.file_list;for(var x=0,w=u.length;x<w;x++){var y=u[x],s=o(t.insertRow(x));s.mouseover(function(A){o(this).addClass("ke-on")}).mouseout(function(A){o(this).removeClass("ke-on")});var q=k+(y.is_dir?"folder-16.gif":"file-16.gif"),z=o('<img src="'+q+'" width="16" height="16" alt="'+y.filename+'" align="absmiddle" />'),v=o(s[0].insertCell(0)).addClass("ke-cell ke-name").append(z).append(document.createTextNode(" "+y.filename));if(!y.is_dir||y.has_file){s.css("cursor","pointer");v.attr("title",y.filename);M(v,r,y,N)}else{v.attr("title",l.emptyFolder)}o(s[0].insertCell(1)).addClass("ke-cell ke-size").html(y.is_dir?"-":Math.ceil(y.filesize/1024)+"KB");o(s[0].insertCell(2)).addClass("ke-cell ke-datetime").html(y.datetime)}}function a(r){K(r,a);var t=r.file_list;for(var w=0,u=t.length;w<u;w++){var x=t[w],z=o('<div class="ke-inline-block ke-item"></div>');I.append(z);var v=o('<div class="ke-inline-block ke-photo"></div>').mouseover(function(A){o(this).addClass("ke-on")}).mouseout(function(A){o(this).removeClass("ke-on")});z.append(v);var s=r.current_url+x.filename,q=x.is_dir?k+"folder-64.gif":(x.is_photo?s:k+"file-64.gif");var y=o('<img src="'+q+'" width="80" height="80" alt="'+x.filename+'" />');if(!x.is_dir||x.has_file){v.css("cursor","pointer");j(v,x);M(v,r,x,a)}else{v.attr("title",l.emptyFolder)}v.append(y);z.append('<div class="ke-name" title="'+x.filename+'">'+x.filename+"</div>")}}F.val(H);h("",O.val(),H=="VIEW"?a:N);return b}});