KindEditor.plugin("flash",function(h){var j=this,a="flash",b=j.lang(a+"."),d=h.undef(j.allowFlashUpload,true),i=h.undef(j.allowFileManager,false),g=h.undef(j.formatUploadUrl,true),f=h.undef(j.extraFileUploadParams,{}),c=h.undef(j.filePostName,"imgFile"),e=h.undef(j.uploadJson,j.basePath+"php/upload_json.php");j.plugin.flash={edit:function(){var o=['<div style="padding:20px;">','<div class="ke-dialog-row">','<label for="keUrl" style="width:60px;">'+b.url+"</label>",'<input class="ke-input-text" type="text" id="keUrl" name="url" value="" style="width:160px;" /> &nbsp;','<input type="button" class="ke-upload-button" value="'+b.upload+'" /> &nbsp;','<span class="ke-button-common ke-button-outer">','<input type="button" class="ke-button-common ke-button" name="viewServer" value="'+b.viewServer+'" />',"</span>","</div>",'<div class="ke-dialog-row">','<label for="keWidth" style="width:60px;">'+b.width+"</label>",'<input type="text" id="keWidth" class="ke-input-text ke-input-number" name="width" value="550" maxlength="4" /> ',"</div>",'<div class="ke-dialog-row">','<label for="keHeight" style="width:60px;">'+b.height+"</label>",'<input type="text" id="keHeight" class="ke-input-text ke-input-number" name="height" value="400" maxlength="4" /> ',"</div>","</div>"].join("");var q=j.createDialog({name:a,width:450,title:j.lang(a),body:o,yesBtn:{name:j.lang("yes"),click:function(y){var v=h.trim(m.val()),x=p.val(),u=r.val();if(v=="http://"||h.invalidUrl(v)){alert(j.lang("invalidUrl"));m[0].focus();return}if(!/^\d*$/.test(x)){alert(j.lang("invalidWidth"));p[0].focus();return}if(!/^\d*$/.test(u)){alert(j.lang("invalidHeight"));r[0].focus();return}var w=h.mediaImg(j.themesPath+"common/blank.gif",{src:v,type:h.mediaType(".swf"),width:x,height:u,quality:"high"});j.insertHtml(w).hideDialog().focus()}}}),k=q.div,m=h('[name="url"]',k),l=h('[name="viewServer"]',k),p=h('[name="width"]',k),r=h('[name="height"]',k);m.val("http://");if(d){var t=h.uploadbutton({button:h(".ke-upload-button",k)[0],fieldName:c,extraParams:f,url:h.addParam(e,"dir=flash"),afterUpload:function(v){q.hideLoading();if(v.error===0){var u=v.url;if(g){u=h.formatUrl(u,"absolute")}m.val(u);if(j.afterUpload){j.afterUpload.call(j,u,v,a)}alert(j.lang("uploadSuccess"))}else{alert(v.message)}},afterError:function(u){q.hideLoading();j.errorDialog(u)}});t.fileBox.change(function(u){q.showLoading(j.lang("uploadLoading"));t.submit()})}else{h(".ke-upload-button",k).hide()}if(i){l.click(function(u){j.loadPlugin("filemanager",function(){j.plugin.filemanagerDialog({viewType:"LIST",dirName:"flash",clickFn:function(v,w){if(j.dialogs.length>1){h('[name="url"]',k).val(v);if(j.afterSelectFile){j.afterSelectFile.call(j,v)}j.hideDialog()}}})})})}else{l.hide()}var n=j.plugin.getSelectedFlash();if(n){var s=h.mediaAttrs(n.attr("data-ke-tag"));m.val(s.src);p.val(h.removeUnit(n.css("width"))||s.width||0);r.val(h.removeUnit(n.css("height"))||s.height||0)}m[0].focus();m[0].select()},"delete":function(){j.plugin.getSelectedFlash().remove();j.addBookmark()}};j.clickToolbar(a,j.plugin.flash.edit)});