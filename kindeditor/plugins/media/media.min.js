KindEditor.plugin("media",function(g){var i=this,a="media",b=i.lang(a+"."),j=g.undef(i.allowMediaUpload,true),h=g.undef(i.allowFileManager,false),f=g.undef(i.formatUploadUrl,true),e=g.undef(i.extraFileUploadParams,{}),c=g.undef(i.filePostName,"imgFile"),d=g.undef(i.uploadJson,i.basePath+"php/upload_json.php");i.plugin.media={edit:function(){var p=['<div style="padding:20px;">','<div class="ke-dialog-row">','<label for="keUrl" style="width:60px;">'+b.url+"</label>",'<input class="ke-input-text" type="text" id="keUrl" name="url" value="" style="width:160px;" /> &nbsp;','<input type="button" class="ke-upload-button" value="'+b.upload+'" /> &nbsp;','<span class="ke-button-common ke-button-outer">','<input type="button" class="ke-button-common ke-button" name="viewServer" value="'+b.viewServer+'" />',"</span>","</div>",'<div class="ke-dialog-row">','<label for="keWidth" style="width:60px;">'+b.width+"</label>",'<input type="text" id="keWidth" class="ke-input-text ke-input-number" name="width" value="550" maxlength="4" />',"</div>",'<div class="ke-dialog-row">','<label for="keHeight" style="width:60px;">'+b.height+"</label>",'<input type="text" id="keHeight" class="ke-input-text ke-input-number" name="height" value="400" maxlength="4" />',"</div>",'<div class="ke-dialog-row">','<label for="keAutostart">'+b.autostart+"</label>",'<input type="checkbox" id="keAutostart" name="autostart" value="" /> ',"</div>","</div>"].join("");var r=i.createDialog({name:a,width:450,height:230,title:i.lang(a),body:p,yesBtn:{name:i.lang("yes"),click:function(z){var w=g.trim(m.val()),y=q.val(),v=s.val();if(w=="http://"||g.invalidUrl(w)){alert(i.lang("invalidUrl"));m[0].focus();return}if(!/^\d*$/.test(y)){alert(i.lang("invalidWidth"));q[0].focus();return}if(!/^\d*$/.test(v)){alert(i.lang("invalidHeight"));s[0].focus();return}var x=g.mediaImg(i.themesPath+"common/blank.gif",{src:w,type:g.mediaType(w),width:y,height:v,autostart:n[0].checked?"true":"false",loop:"true"});i.insertHtml(x).hideDialog().focus()}}}),k=r.div,m=g('[name="url"]',k),l=g('[name="viewServer"]',k),q=g('[name="width"]',k),s=g('[name="height"]',k),n=g('[name="autostart"]',k);m.val("http://");if(j){var u=g.uploadbutton({button:g(".ke-upload-button",k)[0],fieldName:c,extraParams:e,url:g.addParam(d,"dir=media"),afterUpload:function(w){r.hideLoading();if(w.error===0){var v=w.url;if(f){v=g.formatUrl(v,"absolute")}m.val(v);if(i.afterUpload){i.afterUpload.call(i,v,w,a)}alert(i.lang("uploadSuccess"))}else{alert(w.message)}},afterError:function(v){r.hideLoading();i.errorDialog(v)}});u.fileBox.change(function(v){r.showLoading(i.lang("uploadLoading"));u.submit()})}else{g(".ke-upload-button",k).hide()}if(h){l.click(function(v){i.loadPlugin("filemanager",function(){i.plugin.filemanagerDialog({viewType:"LIST",dirName:"media",clickFn:function(w,x){if(i.dialogs.length>1){g('[name="url"]',k).val(w);if(i.afterSelectFile){i.afterSelectFile.call(i,w)}i.hideDialog()}}})})})}else{l.hide()}var o=i.plugin.getSelectedMedia();if(o){var t=g.mediaAttrs(o.attr("data-ke-tag"));m.val(t.src);q.val(g.removeUnit(o.css("width"))||t.width||0);s.val(g.removeUnit(o.css("height"))||t.height||0);n[0].checked=(t.autostart==="true")}m[0].focus();m[0].select()},"delete":function(){i.plugin.getSelectedMedia().remove();i.addBookmark()}};i.clickToolbar(a,i.plugin.media.edit)});