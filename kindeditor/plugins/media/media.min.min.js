KindEditor.plugin("media",function(n){var l=this,t="media",s=l.lang(t+"."),k=n.undef(l.allowMediaUpload,true),m=n.undef(l.allowFileManager,false),o=n.undef(l.formatUploadUrl,true),p=n.undef(l.extraFileUploadParams,{}),r=n.undef(l.filePostName,"imgFile"),q=n.undef(l.uploadJson,l.basePath+"php/upload_json.php");l.plugin.media={edit:function(){var c=['<div style="padding:20px;">','<div class="ke-dialog-row">','<label for="keUrl" style="width:60px;">'+s.url+"</label>",'<input class="ke-input-text" type="text" id="keUrl" name="url" value="" style="width:160px;" /> &nbsp;','<input type="button" class="ke-upload-button" value="'+s.upload+'" /> &nbsp;','<span class="ke-button-common ke-button-outer">','<input type="button" class="ke-button-common ke-button" name="viewServer" value="'+s.viewServer+'" />',"</span>","</div>",'<div class="ke-dialog-row">','<label for="keWidth" style="width:60px;">'+s.width+"</label>",'<input type="text" id="keWidth" class="ke-input-text ke-input-number" name="width" value="550" maxlength="4" />',"</div>",'<div class="ke-dialog-row">','<label for="keHeight" style="width:60px;">'+s.height+"</label>",'<input type="text" id="keHeight" class="ke-input-text ke-input-number" name="height" value="400" maxlength="4" />',"</div>",'<div class="ke-dialog-row">','<label for="keAutostart">'+s.autostart+"</label>",'<input type="checkbox" id="keAutostart" name="autostart" value="" /> ',"</div>","</div>"].join("");var a=l.createDialog({name:t,width:450,height:230,title:l.lang(t),body:c,yesBtn:{name:l.lang("yes"),click:function(C){var A=n.trim(f.val()),D=b.val(),B=v.val();if(A=="http://"||n.invalidUrl(A)){alert(l.lang("invalidUrl"));f[0].focus();return}if(!/^\d*$/.test(D)){alert(l.lang("invalidWidth"));b[0].focus();return}if(!/^\d*$/.test(B)){alert(l.lang("invalidHeight"));v[0].focus();return}var u=n.mediaImg(l.themesPath+"common/blank.gif",{src:A,type:n.mediaType(A),width:D,height:B,autostart:e[0].checked?"true":"false",loop:"true"});l.insertHtml(u).hideDialog().focus()}}}),h=a.div,f=n('[name="url"]',h),g=n('[name="viewServer"]',h),b=n('[name="width"]',h),v=n('[name="height"]',h),e=n('[name="autostart"]',h);f.val("http://");if(k){var i=n.uploadbutton({button:n(".ke-upload-button",h)[0],fieldName:r,extraParams:p,url:n.addParam(q,"dir=media"),afterUpload:function(u){a.hideLoading();if(u.error===0){var x=u.url;if(o){x=n.formatUrl(x,"absolute")}f.val(x);if(l.afterUpload){l.afterUpload.call(l,x,u,t)}alert(l.lang("uploadSuccess"))}else{alert(u.message)}},afterError:function(u){a.hideLoading();l.errorDialog(u)}});i.fileBox.change(function(u){a.showLoading(l.lang("uploadLoading"));i.submit()})}else{n(".ke-upload-button",h).hide()}if(m){g.click(function(u){l.loadPlugin("filemanager",function(){l.plugin.filemanagerDialog({viewType:"LIST",dirName:"media",clickFn:function(z,y){if(l.dialogs.length>1){n('[name="url"]',h).val(z);if(l.afterSelectFile){l.afterSelectFile.call(l,z)}l.hideDialog()}}})})})}else{g.hide()}var d=l.plugin.getSelectedMedia();if(d){var j=n.mediaAttrs(d.attr("data-ke-tag"));f.val(j.src);b.val(n.removeUnit(d.css("width"))||j.width||0);v.val(n.removeUnit(d.css("height"))||j.height||0);e[0].checked=(j.autostart==="true")}f[0].focus();f[0].select()},"delete":function(){l.plugin.getSelectedMedia().remove();l.addBookmark()}};l.clickToolbar(t,l.plugin.media.edit)});