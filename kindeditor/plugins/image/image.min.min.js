KindEditor.plugin("image",function(t){var p=this,B="image",s=t.undef(p.allowImageUpload,true),r=t.undef(p.allowImageRemote,true),u=t.undef(p.formatUploadUrl,true),q=t.undef(p.allowFileManager,false),x=t.undef(p.uploadJson,p.basePath+"php/upload_json.php"),y=t.undef(p.imageTabIndex,0),v=p.pluginsPath+"image/images/",w=t.undef(p.extraFileUploadParams,{}),z=t.undef(p.filePostName,"imgFile"),o=t.undef(p.fillDescAfterUploadImage,false),A=p.lang(B+".");p.plugin.imageDialog=function(aa){var e=aa.imageUrl,n=t.undef(aa.imageWidth,""),c=t.undef(aa.imageHeight,""),k=t.undef(aa.imageTitle,""),j=t.undef(aa.imageAlign,""),ai=t.undef(aa.showRemote,true),ag=t.undef(aa.showLocal,true),Y=t.undef(aa.tabIndex,0),ad=aa.clickFn;var a="kindeditor_upload_iframe_"+new Date().getTime();var ac=[];for(var T in w){ac.push('<input type="hidden" name="'+T+'" value="'+w[T]+'" />')}var l=['<div style="padding:20px;">','<div class="tabs"></div>','<div class="tab1" style="display:none;">','<div class="ke-dialog-row">','<label for="remoteUrl" style="width:60px;">'+A.remoteUrl+"</label>",'<input type="text" id="remoteUrl" class="ke-input-text" name="url" value="" style="width:200px;" /> &nbsp;','<span class="ke-button-common ke-button-outer">','<input type="button" class="ke-button-common ke-button" name="viewServer" value="'+A.viewServer+'" />',"</span>","</div>",'<div class="ke-dialog-row">','<label for="remoteWidth" style="width:60px;">'+A.size+"</label>",A.width+' <input type="text" id="remoteWidth" class="ke-input-text ke-input-number" name="width" value="" maxlength="4" /> ',A.height+' <input type="text" class="ke-input-text ke-input-number" name="height" value="" maxlength="4" /> ','<img class="ke-refresh-btn" src="'+v+'refresh.png" width="16" height="16" alt="" style="cursor:pointer;" title="'+A.resetSize+'" />',"</div>",'<div class="ke-dialog-row">','<label style="width:60px;">'+A.align+"</label>",'<input type="radio" name="align" class="ke-inline-block" value="" checked="checked" /> <img name="defaultImg" src="'+v+'align_top.gif" width="23" height="25" alt="" />',' <input type="radio" name="align" class="ke-inline-block" value="left" /> <img name="leftImg" src="'+v+'align_left.gif" width="23" height="25" alt="" />',' <input type="radio" name="align" class="ke-inline-block" value="right" /> <img name="rightImg" src="'+v+'align_right.gif" width="23" height="25" alt="" />',"</div>",'<div class="ke-dialog-row">','<label for="remoteTitle" style="width:60px;">'+A.imgTitle+"</label>",'<input type="text" id="remoteTitle" class="ke-input-text" name="title" value="" style="width:200px;" />',"</div>","</div>",'<div class="tab2" style="display:none;">','<iframe name="'+a+'" style="display:none;"></iframe>','<form class="ke-upload-area ke-form" method="post" enctype="multipart/form-data" target="'+a+'" action="'+t.addParam(x,"dir=image")+'">','<div class="ke-dialog-row">',ac.join(""),'<label style="width:60px;">'+A.localUrl+"</label>",'<input type="text" name="localUrl" class="ke-input-text" tabindex="-1" style="width:200px;" readonly="true" /> &nbsp;','<input type="button" class="ke-upload-button" value="'+A.upload+'" />',"</div>","</form>","</div>","</div>"].join("");var ae=ag||q?450:400,U=ag&&ai?300:250;var i=p.createDialog({name:B,width:ae,height:U,title:p.lang(B),body:l,yesBtn:{name:p.lang("yes"),click:function(C){if(i.isLoading){return}if(ag&&ai&&f&&f.selectedIndex===1||!ai){if(X.fileBox.val()==""){alert(p.lang("pleaseSelectFile"));return}i.showLoading(p.lang("uploadLoading"));X.submit();W.val("");return}var E=t.trim(ah.val()),D=ab.val(),F=b.val(),H=h.val(),G="";aj.each(function(){if(this.checked){G=this.value;return false}});if(E=="http://"||t.invalidUrl(E)){alert(p.lang("invalidUrl"));ah[0].focus();return}if(!/^\d*$/.test(D)){alert(p.lang("invalidWidth"));ab[0].focus();return}if(!/^\d*$/.test(F)){alert(p.lang("invalidHeight"));b[0].focus();return}ad.call(p,E,H,D,F,0,G)}},beforeRemove:function(){Z.unbind();ab.unbind();b.unbind();m.unbind()}}),af=i.div;var ah=t('[name="url"]',af),W=t('[name="localUrl"]',af),Z=t('[name="viewServer"]',af),ab=t('.tab1 [name="width"]',af),b=t('.tab1 [name="height"]',af),m=t(".ke-refresh-btn",af),h=t('.tab1 [name="title"]',af),aj=t('.tab1 [name="align"]',af);var f;if(ai&&ag){f=t.tabs({src:t(".tabs",af),afterSelect:function(C){}});f.add({title:A.remoteImage,panel:t(".tab1",af)});f.add({title:A.localImage,panel:t(".tab2",af)});f.select(Y)}else{if(ai){t(".tab1",af).show()}else{if(ag){t(".tab2",af).show()}}}var X=t.uploadbutton({button:t(".ke-upload-button",af)[0],fieldName:z,form:t(".ke-form",af),target:a,width:60,afterUpload:function(C){i.hideLoading();if(C.error===0){var D=C.url;if(u){D=t.formatUrl(D,"absolute")}if(p.afterUpload){p.afterUpload.call(p,D,C,B)}if(!o){ad.call(p,D,C.title,C.width,C.height,C.border,C.align)}else{t(".ke-dialog-row #remoteUrl",af).val(D);t(".ke-tabs-li",af)[0].click();t(".ke-refresh-btn",af).click()}}else{alert(C.message)}},afterError:function(C){i.hideLoading();p.errorDialog(C)}});X.fileBox.change(function(C){W.val(X.fileBox.val())});if(q){Z.click(function(C){p.loadPlugin("filemanager",function(){p.plugin.filemanagerDialog({viewType:"VIEW",dirName:"image",clickFn:function(E,D){if(p.dialogs.length>1){t('[name="url"]',af).val(E);if(p.afterSelectFile){p.afterSelectFile.call(p,E)}p.hideDialog()}}})})})}else{Z.hide()}var d=0,V=0;function g(C,D){ab.val(C);b.val(D);d=C;V=D}m.click(function(C){var D=t('<img src="'+ah.val()+'" />',document).css({position:"absolute",visibility:"hidden",top:0,left:"-1000px"});D.bind("load",function(){g(D.width(),D.height());D.remove()});t(document.body).append(D)});ab.change(function(C){if(d>0){b.val(Math.round(V/d*parseInt(this.value,10)))}});b.change(function(C){if(V>0){ab.val(Math.round(d/V*parseInt(this.value,10)))}});ah.val(aa.imageUrl);g(aa.imageWidth,aa.imageHeight);h.val(aa.imageTitle);aj.each(function(){if(this.value===aa.imageAlign){this.checked=true;return false}});if(ai&&Y===0){ah[0].focus();ah[0].select()}return i};p.plugin.image={edit:function(){var a=p.plugin.getSelectedImage();p.plugin.imageDialog({imageUrl:a?a.attr("data-ke-src"):"http://",imageWidth:a?a.width():"",imageHeight:a?a.height():"",imageTitle:a?a.attr("title"):"",imageAlign:a?a.attr("align"):"",showRemote:r,showLocal:s,tabIndex:a?0:y,clickFn:function(e,c,d,g,f,b){if(a){a.attr("src",e);a.attr("data-ke-src",e);a.attr("width",d);a.attr("height",g);a.attr("title",c);a.attr("align",b);a.attr("alt",c)}else{p.exec("insertimage",e,c,d,g,f,b)}setTimeout(function(){p.hideDialog().focus()},0)}})},"delete":function(){var a=p.plugin.getSelectedImage();if(a.parent().name=="a"){a=a.parent()}a.remove();p.addBookmark()}};p.clickToolbar(B,p.plugin.image.edit)});