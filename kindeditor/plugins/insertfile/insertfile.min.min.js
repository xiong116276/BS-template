KindEditor.plugin("insertfile",function(m){var k=this,t="insertfile",s=m.undef(k.allowFileUpload,true),l=m.undef(k.allowFileManager,false),n=m.undef(k.formatUploadUrl,true),p=m.undef(k.uploadJson,k.basePath+"php/upload_json.php"),o=m.undef(k.extraFileUploadParams,{}),q=m.undef(k.filePostName,"imgFile"),r=k.lang(t+".");k.plugin.fileDialog=function(i){var v=m.undef(i.fileUrl,"http://"),d=m.undef(i.fileTitle,""),h=i.clickFn;var c=['<div style="padding:20px;">','<div class="ke-dialog-row">','<label for="keUrl" style="width:60px;">'+r.url+"</label>",'<input type="text" id="keUrl" name="url" class="ke-input-text" style="width:160px;" /> &nbsp;','<input type="button" class="ke-upload-button" value="'+r.upload+'" /> &nbsp;','<span class="ke-button-common ke-button-outer">','<input type="button" class="ke-button-common ke-button" name="viewServer" value="'+r.viewServer+'" />',"</span>","</div>",'<div class="ke-dialog-row">','<label for="keTitle" style="width:60px;">'+r.title+"</label>",'<input type="text" id="keTitle" class="ke-input-text" name="title" value="" style="width:160px;" /></div>',"</div>","</form>","</div>"].join("");var a=k.createDialog({name:t,width:450,title:k.lang(t),body:c,yesBtn:{name:k.lang("yes"),click:function(y){var z=m.trim(e.val()),u=b.val();if(z=="http://"||m.invalidUrl(z)){alert(k.lang("invalidUrl"));e[0].focus();return}if(m.trim(u)===""){u=z}h.call(k,z,u)}}}),g=a.div;var e=m('[name="url"]',g),f=m('[name="viewServer"]',g),b=m('[name="title"]',g);if(s){var j=m.uploadbutton({button:m(".ke-upload-button",g)[0],fieldName:q,url:m.addParam(p,"dir=file"),extraParams:o,afterUpload:function(u){a.hideLoading();if(u.error===0){var x=u.url;if(n){x=m.formatUrl(x,"absolute")}e.val(x);if(k.afterUpload){k.afterUpload.call(k,x,u,t)}alert(k.lang("uploadSuccess"))}else{alert(u.message)}},afterError:function(u){a.hideLoading();k.errorDialog(u)}});j.fileBox.change(function(u){a.showLoading(k.lang("uploadLoading"));j.submit()})}else{m(".ke-upload-button",g).hide()}if(l){f.click(function(u){k.loadPlugin("filemanager",function(){k.plugin.filemanagerDialog({viewType:"LIST",dirName:"file",clickFn:function(z,y){if(k.dialogs.length>1){m('[name="url"]',g).val(z);if(k.afterSelectFile){k.afterSelectFile.call(k,z)}k.hideDialog()}}})})})}else{f.hide()}e.val(v);b.val(d);e[0].focus();e[0].select()};k.clickToolbar(t,function(){k.plugin.fileDialog({clickFn:function(c,a){var b='<a class="ke-insertfile" href="'+c+'" data-ke-src="'+c+'" target="_blank">'+a+"</a>";k.insertHtml(b).hideDialog().focus()}})})});