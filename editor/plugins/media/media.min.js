KindEditor.plugin("media",function(h){var j=this,a="media",b=j.lang(a+"."),i=h.undef(j.allowFileManager,false),k=h.undef(j.allowMediaUpload,true),e=h.undef(j.uploadJson,j.basePath+"php/upload_json.php"),c=h.undef(j.uploadMediaExtension,""),d=h.undef(j.filePostName,"imgFile"),g=h.undef(j.extraFileUploadParams,{}),f=h.undef(j.formatUploadUrl,true);j.plugin.media={edit:function(){var q=['<div style="padding:20px;">','<div class="ke-dialog-row">','<label for="keUrl" style="width:60px;">'+b.url+"</label>",'<input class="ke-input-text" type="text" id="keUrl" name="url" value="" style="width:160px;" /> &nbsp;','<input type="button" class="ke-upload-button" value="'+b.upload+'" /> &nbsp;','<span class="ke-button-common ke-button-outer">','<input type="button" class="ke-button-common ke-button" name="viewServer" value="'+b.viewServer+'" />',"</span>","</div>",'<div class="ke-dialog-row">','<label for="keWidth" style="width:60px;">'+b.width+"</label>",'<input type="text" id="keWidth" class="ke-input-text ke-input-number" name="width" value="550" maxlength="4" />',"</div>",'<div class="ke-dialog-row">','<label for="keHeight" style="width:60px;">'+b.height+"</label>",'<input type="text" id="keHeight" class="ke-input-text ke-input-number" name="height" value="400" maxlength="4" />',"</div>",'<div class="ke-dialog-row">','<label for="keAutostart">'+b.autostart+"</label>",'<input type="checkbox" id="keAutostart" name="autostart" value="" /> ',"</div>","</div>"].join("");var s=j.createDialog({name:a,width:450,height:230,title:j.lang(a),body:q,yesBtn:{name:j.lang("yes"),click:function(A){var x=h.trim(n.val()),z=r.val(),w=t.val();if(x=="http://"||h.invalidUrl(x)){alert(j.lang("invalidUrl"));n[0].focus();return}if(!/^\d*$/.test(z)){alert(j.lang("invalidWidth"));r[0].focus();return}if(!/^\d*$/.test(w)){alert(j.lang("invalidHeight"));t[0].focus();return}var y=h.mediaImg(j.themesPath+"common/blank.gif",{src:x,type:h.mediaType(x),width:z,height:w,autostart:o[0].checked?"true":"false",loop:"true"});j.insertHtml(y).hideDialog().focus()}}}),l=s.div,n=h('[name="url"]',l),m=h('[name="viewServer"]',l),r=h('[name="width"]',l),t=h('[name="height"]',l),o=h('[name="autostart"]',l);n.val("http://");if(k&&c!=""){var v=h.uploadbutton({button:h(".ke-upload-button",l)[0],fieldName:d,extraParams:g,url:h.addParam(e,"fileType=media"),afterUpload:function(x){s.hideLoading();var w=x.url;if(w!=null){if(f){w=h.formatUrl(w,"absolute")}n.val(w);if(j.afterUpload){j.afterUpload.call(j,w,x,a)}alert(j.lang("uploadSuccess"))}else{alert(x.content)}},afterError:function(w){s.hideLoading();j.errorDialog(w)}});v.fileBox.change(function(w){if(new RegExp("^\\S.*\\.("+c.replace(/,/g,"|")+")$","i").test(v.fileBox.val())){s.showLoading(j.lang("uploadLoading"));v.submit()}else{alert(j.lang("uploadTypeInvalid"))}})}else{h(".ke-upload-button",l).hide()}if(i){m.click(function(w){j.loadPlugin("filemanager",function(){j.plugin.filemanagerDialog({fileType:"media",viewType:"list",clickFn:function(x,y){if(j.dialogs.length>1){h('[name="url"]',l).val(x);if(j.afterSelectFile){j.afterSelectFile.call(j,x)}j.hideDialog()}}})})})}else{m.hide()}var p=j.plugin.getSelectedMedia();if(p){var u=h.mediaAttrs(p.attr("data-ke-tag"));n.val(u.src);r.val(h.removeUnit(p.css("width"))||u.width||0);t.val(h.removeUnit(p.css("height"))||u.height||0);o[0].checked=(u.autostart==="true")}n[0].focus();n[0].select()},"delete":function(){j.plugin.getSelectedMedia().remove()}};j.clickToolbar(a,j.plugin.media.edit)});