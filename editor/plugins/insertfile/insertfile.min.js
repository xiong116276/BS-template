KindEditor.plugin("insertfile",function(h){var k=this,a="insertfile",b=h.undef(k.allowFileUpload,true),i=h.undef(k.allowFileManager,false),g=h.undef(k.formatUploadUrl,true),e=h.undef(k.uploadJson,k.basePath+"php/upload_json.php"),j=h.undef(k.uploadFileExtension,""),f=h.undef(k.extraFileUploadParams,{}),d=h.undef(k.filePostName,"imgFile"),c=k.lang(a+".");k.plugin.fileDialog=function(v){var t=h.undef(v.fileUrl,"http://"),p=h.undef(v.fileTitle,""),l=v.clickFn;var q=['<div style="padding:20px;">','<div class="ke-dialog-row">','<label for="keUrl" style="width:60px;">'+c.url+"</label>",'<input type="text" id="keUrl" name="url" class="ke-input-text" style="width:160px;" /> &nbsp;','<input type="button" class="ke-upload-button" value="'+c.upload+'" /> &nbsp;','<span class="ke-button-common ke-button-outer">','<input type="button" class="ke-button-common ke-button" name="viewServer" value="'+c.viewServer+'" />',"</span>","</div>",'<div class="ke-dialog-row">','<label for="keTitle" style="width:60px;">'+c.title+"</label>",'<input type="text" id="keTitle" class="ke-input-text" name="title" value="" style="width:160px;" /></div>',"</div>","</form>","</div>"].join("");var s=k.createDialog({name:a,width:450,title:k.lang(a),body:q,yesBtn:{name:k.lang("yes"),click:function(x){var w=h.trim(o.val()),y=r.val();if(w=="http://"||h.invalidUrl(w)){alert(k.lang("invalidUrl"));o[0].focus();return}if(h.trim(y)===""){y=w}l.call(k,w,y)}}}),m=s.div;var o=h('[name="url"]',m),n=h('[name="viewServer"]',m),r=h('[name="title"]',m);if(b){var u=h.uploadbutton({button:h(".ke-upload-button",m)[0],fieldName:d,url:h.addParam(e,"fileType=file"),extraParams:f,afterUpload:function(x){s.hideLoading();var w=x.url;if(w!=null){if(g){w=h.formatUrl(w,"absolute")}o.val(w);if(k.afterUpload){k.afterUpload.call(k,w,x,a)}alert(k.lang("uploadSuccess"))}else{alert(x.content)}},afterError:function(w){s.hideLoading();k.errorDialog(w)}});u.fileBox.change(function(w){if(new RegExp("^\\S.*\\.("+j.replace(/,/g,"|")+")$","i").test(u.fileBox.val())){s.showLoading(k.lang("uploadLoading"));u.submit()}else{alert(k.lang("uploadTypeInvalid"))}})}else{h(".ke-upload-button",m).hide()}if(i){n.click(function(w){k.loadPlugin("filemanager",function(){k.plugin.filemanagerDialog({fileType:"file",viewType:"LIST",clickFn:function(x,y){if(k.dialogs.length>1){h('[name="url"]',m).val(x);if(k.afterSelectFile){k.afterSelectFile.call(k,x)}k.hideDialog()}}})})})}else{n.hide()}o.val(t);r.val(p);o[0].focus();o[0].select()};k.clickToolbar(a,function(){k.plugin.fileDialog({clickFn:function(l,n){var m='<a class="ke-insertfile" href="'+l+'" data-ke-src="'+l+'" target="_blank">'+n+"</a>";k.insertHtml(m).hideDialog().focus()}})})});