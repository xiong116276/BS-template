KindEditor.plugin("image",function(j){var n=this,a="image",m=j.undef(n.allowFileManager,false),k=j.undef(n.allowImageUpload,true),l=j.undef(n.allowImageRemote,true),f=j.undef(n.uploadJson,n.basePath+"php/upload_json.php"),d=j.undef(n.uploadImageExtension,""),c=j.undef(n.filePostName,"imgFile"),i=j.undef(n.extraFileUploadParams,{}),h=j.undef(n.formatUploadUrl,true),e=j.undef(n.imageTabIndex,0),g=n.pluginsPath+"image/images/",o=j.undef(n.fillDescAfterUploadImage,false),b=n.lang(a+".");n.plugin.imageDialog=function(u){var P=u.imageUrl,y=j.undef(u.imageWidth,""),R=j.undef(u.imageHeight,""),K=j.undef(u.imageTitle,""),A=j.undef(u.imageAlign,""),q=j.undef(u.showRemote,true),r=j.undef(u.showLocal,true),v=j.undef(u.tabIndex,0),D=u.clickFn;var T="kindeditor_upload_iframe_"+new Date().getTime();var E=[];for(var I in i){E.push('<input type="hidden" name="'+I+'" value="'+i[I]+'" />')}var z=['<div style="padding:20px;">','<div class="tabs"></div>','<div class="tab1" style="display:none;">','<div class="ke-dialog-row">','<label for="remoteUrl" style="width:60px;">'+b.remoteUrl+"</label>",'<input type="text" id="remoteUrl" class="ke-input-text" name="url" value="" style="width:200px;" /> &nbsp;','<span class="ke-button-common ke-button-outer">','<input type="button" class="ke-button-common ke-button" name="viewServer" value="'+b.viewServer+'" />',"</span>","</div>",'<div class="ke-dialog-row">','<label for="remoteWidth" style="width:60px;">'+b.size+"</label>",b.width+' <input type="text" id="remoteWidth" class="ke-input-text ke-input-number" name="width" value="" maxlength="4" /> ',b.height+' <input type="text" class="ke-input-text ke-input-number" name="height" value="" maxlength="4" /> ','<img class="ke-refresh-btn" src="'+g+'refresh.png" width="16" height="16" alt="" style="cursor:pointer;" title="'+b.resetSize+'" />',"</div>",'<div class="ke-dialog-row">','<label style="width:60px;">'+b.align+"</label>",'<input type="radio" name="align" class="ke-inline-block" value="" checked="checked" /> <img name="defaultImg" src="'+g+'align_top.gif" width="23" height="25" alt="" />',' <input type="radio" name="align" class="ke-inline-block" value="left" /> <img name="leftImg" src="'+g+'align_left.gif" width="23" height="25" alt="" />',' <input type="radio" name="align" class="ke-inline-block" value="right" /> <img name="rightImg" src="'+g+'align_right.gif" width="23" height="25" alt="" />',"</div>",'<div class="ke-dialog-row">','<label for="remoteTitle" style="width:60px;">'+b.imgTitle+"</label>",'<input type="text" id="remoteTitle" class="ke-input-text" name="title" value="" style="width:200px;" />',"</div>","</div>",'<div class="tab2" style="display:none;">','<iframe name="'+T+'" style="display:none;"></iframe>','<form class="ke-upload-area ke-form" method="post" enctype="multipart/form-data" target="'+T+'" action="'+j.addParam(f,"fileType=image")+'">','<div class="ke-dialog-row">',E.join(""),'<label style="width:60px;">'+b.localUrl+"</label>",'<input type="text" name="localUrl" class="ke-input-text" tabindex="-1" style="width:200px;" readonly="true" /> &nbsp;','<input type="button" class="ke-upload-button" value="'+b.upload+'" />',"</div>","</form>","</div>","</div>"].join("");var s=r||m?450:400,x=r&&q?300:250;var L=n.createDialog({name:a,width:s,height:x,title:n.lang(a),body:z,yesBtn:{name:n.lang("yes"),click:function(X){if(L.isLoading){return}if(r&&q&&O&&O.selectedIndex===1||!q){if(G.fileBox.val()==""){alert(n.lang("pleaseSelectFile"));return}if(new RegExp("^\\S.*\\.("+d.replace(/,/g,"|")+")$","i").test(G.fileBox.val())){L.showLoading(n.lang("uploadLoading"));G.submit();w.val("")}else{alert(n.lang("uploadTypeInvalid"))}return}var V=j.trim(B.val()),W=t.val(),U=S.val(),Y=M.val(),Z="";p.each(function(){if(this.checked){Z=this.value;return false}});if(V=="http://"||j.invalidUrl(V)){alert(n.lang("invalidUrl"));B[0].focus();return}if(!/^\d*$/.test(W)){alert(n.lang("invalidWidth"));t[0].focus();return}if(!/^\d*$/.test(U)){alert(n.lang("invalidHeight"));S[0].focus();return}D.call(n,V,Y,W,U,0,Z)}},beforeRemove:function(){F.unbind();t.unbind();S.unbind();J.unbind()}}),C=L.div;var B=j('[name="url"]',C),w=j('[name="localUrl"]',C),F=j('[name="viewServer"]',C),t=j('.tab1 [name="width"]',C),S=j('.tab1 [name="height"]',C),J=j(".ke-refresh-btn",C),M=j('.tab1 [name="title"]',C),p=j('.tab1 [name="align"]',C);var O;if(q&&r){O=j.tabs({src:j(".tabs",C),afterSelect:function(U){}});O.add({title:b.remoteImage,panel:j(".tab1",C)});O.add({title:b.localImage,panel:j(".tab2",C)});O.select(v)}else{if(q){j(".tab1",C).show()}else{if(r){j(".tab2",C).show()}}}var G=j.uploadbutton({button:j(".ke-upload-button",C)[0],fieldName:c,url:j.addParam(f,"fileType=image"),form:j(".ke-form",C),target:T,width:60,afterUpload:function(V){L.hideLoading();var U=V.url;if(U!=null){if(h){U=j.formatUrl(U,"absolute")}if(n.afterUpload){n.afterUpload.call(n,U,V,a)}if(!o){D.call(n,U,V.title,V.width,V.height,V.border,V.align)}else{j(".ke-dialog-row #remoteUrl",C).val(U);j(".ke-tabs-li",C)[0].click();j(".ke-refresh-btn",C).click()}}else{alert(V.content)}},afterError:function(U){L.hideLoading();n.errorDialog(U)}});G.fileBox.change(function(U){w.val(G.fileBox.val())});if(m){F.click(function(U){n.loadPlugin("filemanager",function(){n.plugin.filemanagerDialog({fileType:"image",viewType:"view",clickFn:function(V,W){if(n.dialogs.length>1){j('[name="url"]',C).val(V);if(n.afterSelectFile){n.afterSelectFile.call(n,V)}n.hideDialog()}}})})})}else{F.hide()}var Q=0,H=0;function N(V,U){t.val(V);S.val(U);Q=V;H=U}J.click(function(V){var U=j('<img src="'+B.val()+'" />',document).css({position:"absolute",visibility:"hidden",top:0,left:"-1000px"});U.bind("load",function(){N(U.width(),U.height());U.remove()});j(document.body).append(U)});t.change(function(U){if(Q>0){S.val(Math.round(H/Q*parseInt(this.value,10)))}});S.change(function(U){if(H>0){t.val(Math.round(Q/H*parseInt(this.value,10)))}});B.val(u.imageUrl);N(u.imageWidth,u.imageHeight);M.val(u.imageTitle);p.each(function(){if(this.value===u.imageAlign){this.checked=true;return false}});if(q&&v===0){B[0].focus();B[0].select()}return L};n.plugin.image={edit:function(){var p=n.plugin.getSelectedImage();n.plugin.imageDialog({imageUrl:p?p.attr("data-ke-src"):"http://",imageWidth:p?p.width():"",imageHeight:p?p.height():"",imageTitle:p?p.attr("title"):"",imageAlign:p?p.attr("align"):"",showRemote:l,showLocal:k&&d!="",tabIndex:p?0:e,clickFn:function(s,u,t,q,r,v){n.exec("insertimage",s,u,t,q,r,v);setTimeout(function(){n.hideDialog().focus()},0)}})},"delete":function(){var p=n.plugin.getSelectedImage();if(p.parent().name=="a"){p=p.parent()}p.remove()}};n.clickToolbar(a,n.plugin.image.edit)});