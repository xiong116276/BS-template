KindEditor.plugin("flash",function(h){var k=this,a="flash",b=k.lang(a+"."),j=h.undef(k.allowFileManager,false),d=h.undef(k.allowFlashUpload,true),e=h.undef(k.uploadJson,k.basePath+"php/upload_json.php"),i=h.undef(k.uploadFlashExtension,""),c=h.undef(k.filePostName,"imgFile"),g=h.undef(k.extraFileUploadParams,{}),f=h.undef(k.formatUploadUrl,true);k.plugin.flash={edit:function(){var p=['<div style="padding:20px;">','<div class="ke-dialog-row">','<label for="keUrl" style="width:60px;">'+b.url+"</label>",'<input class="ke-input-text" type="text" id="keUrl" name="url" value="" style="width:160px;" /> &nbsp;','<input type="button" class="ke-upload-button" value="'+b.upload+'" /> &nbsp;','<span class="ke-button-common ke-button-outer">','<input type="button" class="ke-button-common ke-button" name="viewServer" value="'+b.viewServer+'" />',"</span>","</div>",'<div class="ke-dialog-row">','<label for="keWidth" style="width:60px;">'+b.width+"</label>",'<input type="text" id="keWidth" class="ke-input-text ke-input-number" name="width" value="550" maxlength="4" /> ',"</div>",'<div class="ke-dialog-row">','<label for="keHeight" style="width:60px;">'+b.height+"</label>",'<input type="text" id="keHeight" class="ke-input-text ke-input-number" name="height" value="400" maxlength="4" /> ',"</div>","</div>"].join("");var r=k.createDialog({name:a,width:450,title:k.lang(a),body:p,yesBtn:{name:k.lang("yes"),click:function(z){var w=h.trim(n.val()),y=q.val(),v=s.val();if(w=="http://"||h.invalidUrl(w)){alert(k.lang("invalidUrl"));n[0].focus();return}if(!/^\d*$/.test(y)){alert(k.lang("invalidWidth"));q[0].focus();return}if(!/^\d*$/.test(v)){alert(k.lang("invalidHeight"));s[0].focus();return}var x=h.mediaImg(k.themesPath+"common/blank.gif",{src:w,type:h.mediaType(".swf"),width:y,height:v,quality:"high"});k.insertHtml(x).hideDialog().focus()}}}),l=r.div,n=h('[name="url"]',l),m=h('[name="viewServer"]',l),q=h('[name="width"]',l),s=h('[name="height"]',l);n.val("http://");if(d&&i!=""){var u=h.uploadbutton({button:h(".ke-upload-button",l)[0],fieldName:c,extraParams:g,url:h.addParam(e,"fileType=flash"),afterUpload:function(w){r.hideLoading();var v=w.url;if(v!=null){if(f){v=h.formatUrl(v,"absolute")}n.val(v);if(k.afterUpload){k.afterUpload.call(k,v,w,a)}alert(k.lang("uploadSuccess"))}else{alert(w.content)}},afterError:function(v){r.hideLoading();k.errorDialog(v)}});u.fileBox.change(function(v){if(new RegExp("^\\S.*\\.("+i.replace(/,/g,"|")+")$","i").test(u.fileBox.val())){r.showLoading(k.lang("uploadLoading"));u.submit()}else{alert(k.lang("uploadTypeInvalid"))}})}else{h(".ke-upload-button",l).hide()}if(j){m.click(function(v){k.loadPlugin("filemanager",function(){k.plugin.filemanagerDialog({fileType:"flash",viewType:"list",clickFn:function(w,x){if(k.dialogs.length>1){h('[name="url"]',l).val(w);if(k.afterSelectFile){k.afterSelectFile.call(k,w)}k.hideDialog()}}})})})}else{m.hide()}var o=k.plugin.getSelectedFlash();if(o){var t=h.mediaAttrs(o.attr("data-ke-tag"));n.val(t.src);q.val(h.removeUnit(o.css("width"))||t.width||0);s.val(h.removeUnit(o.css("height"))||t.height||0)}n[0].focus();n[0].select()},"delete":function(){k.plugin.getSelectedFlash().remove()}};k.clickToolbar(a,k.plugin.flash.edit)});