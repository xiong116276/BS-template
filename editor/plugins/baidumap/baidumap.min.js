KindEditor.plugin("baidumap",function(a){var b=this,d="baidumap",f=b.lang(d+".");var c=a.undef(b.mapWidth,558);var e=a.undef(b.mapHeight,360);b.clickToolbar(d,function(){var i=['<div style="padding:10px 20px;">','<div class="ke-header">','<div class="ke-left">',f.address+' <input id="kindeditor_plugin_map_address" name="address" class="ke-input-text" value="" style="width:200px;" /> ','<span class="ke-button-common ke-button-outer">','<input type="button" name="searchBtn" class="ke-button-common ke-button" value="'+f.search+'" />',"</span>","</div>",'<div class="ke-right">','<input type="checkbox" id="keInsertDynamicMap" name="insertDynamicMap" value="1" /> <label for="keInsertDynamicMap">'+f.insertDynamicMap+"</label>","</div>",'<div class="ke-clearfix"></div>',"</div>",'<div class="ke-map" style="width:'+c+"px;height:"+e+'px;"></div>',"</div>"].join("");var n=b.createDialog({name:d,width:c+42,title:b.lang(d),body:i,yesBtn:{name:b.lang("yes"),click:function(v){var u=l.map;var t=u.getCenter();var q=t.lng+","+t.lat;var s=u.getZoom();var r=[k[0].checked?b.pluginsPath+"baidumap/01index.html":"http://api.map.baidu.com/staticimage","?center="+encodeURIComponent(q),"&zoom="+encodeURIComponent(s),"&width="+c,"&height="+e,"&markers="+encodeURIComponent(q),"&markerStyles="+encodeURIComponent("l,A")].join("");if(k[0].checked){b.insertHtml('<iframe src="'+r+'" frameborder="0" style="width:'+(c+2)+"px;height:"+(e+2)+'px;"></iframe>')}else{b.exec("insertimage",r)}b.hideDialog().focus()}},beforeRemove:function(){m.remove();if(p){p.write("")}h.remove()}});var g=n.div,j=a('[name="address"]',g),m=a('[name="searchBtn"]',g),k=a('[name="insertDynamicMap"]',n.div),l,p;var h=a('<iframe class="ke-textarea" frameborder="0" src="'+b.pluginsPath+'baidumap/map.html" style="width:'+c+"px;height:"+e+'px;"></iframe>');function o(){l=h[0].contentWindow;p=a.iframeDoc(h)}h.bind("load",function(){h.unbind("load");if(a.IE){o()}else{setTimeout(o,0)}});a(".ke-map",g).replaceWith(h);m.click(function(){l.search(j.val())})})});